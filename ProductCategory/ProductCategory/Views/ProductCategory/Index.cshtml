@using ProductCategory.Domain.Entities;
@{
    ViewData["Title"] = "Category";
}

@model IEnumerable<ProductCategory.Domain.Entities.ProductCategoryEntity>

<div class="container mt-5">

    <form id="dataForm" method="post" class="needs-validation" novalidate>
        <div class="form-group mb-1">
            <label for="name">Name:</label>
            <input name="Name" type="text" class="form-control"
                   id="name" required>
            <div class="valid-feedback">
                Looks good!
            </div>
        </div>
        <div class="form-group mb-1">
            <label for="description">Description:</label>
            <input name="Description" class="form-control"
                   type="text"   id="description" required/>
            <div class="valid-feedback">
                Looks good!
            </div>
        </div>
        <button id="createFile" type="submit" class="btn btn-primary">Submit</button>
    </form>
    <button id="createFile" type="submit" onclick="changeData('1')" class="btn btn-primary">Edit</button>

    <h2 class="mt-5">Data Table</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="dataTableBody">
            @foreach (var category in Model)
            {
                <tr>
                    <td>@category.Name</td>
                    <td>@category.Description</td>
                    <td>
                        <button class="btn btn-warning" onclick="setChangeId('@category.Id', 
                                '@category.Name', '@category.Description')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteData('@category.Id')">Delete</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts
{
    <script>
        var changeId = "";

        function setChangeId(Id, name, description) {
            changeId = Id;
            document.getElementById("name").value = name;
            document.getElementById("description").value = description;
        }

        function changeData(){
            var name = document.getElementById("name").value;
            var description = document.getElementById("description").value;
            $.ajax({
                type: 'PUT',
                url: '@Url.Action("ChangeCategory", "Product")',
                data: { id: changeId, description: description, name: name },
                success: function (response) {
                    alert(response.description);
                },
                error: function (response) {
                    alert(response.description);
                }
            })
        }

        $('#createFile').on('click', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("CreateCategory", "Product")',
                data: $('#dataForm').serialize(),
                success: function (response) {
                    alert(response.description);
                },
                error: function (response) {
                    alert(response.description);
                }
            })
            document.getElementById("name").value = '';
            document.getElementById("description").value = '';
        });

        function deleteData(Id) {
            $.ajax({
                type: 'DELETE',
                url: '@Url.Action("DeleteCategory", "Product")',
                data: { Id: Id , },
                success: function (response) {
                    alert(response.description);
                },
                error: function (response) {
                    alert(response.description);
                }
            })
        }
    </script>
}
